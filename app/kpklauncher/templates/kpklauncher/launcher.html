{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <title>KPK Control Panel</title>
    <link rel="icon" href="{% static 'kpklauncher/media/kpk.ico'%}">
    <link href="{% static 'kpklauncher/css/launcher.css'%}" rel="stylesheet">
    <script>
      // Immediate theme initialization before any rendering
      (function() {
          const savedTheme = localStorage.getItem('theme');
          const theme = savedTheme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
          document.documentElement.setAttribute('data-theme', theme);
      })();
    </script>
  </head>
  <body>
    <script>
      console.log('Page loaded');
      console.log('CSS file path:', '{% static "kpklauncher/css/launcher.css" %}');
    </script>
    
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
      <symbol id="excel-file" viewBox="0 0 16 16">
        <path d="M15.334,1.97H9.81v1.8h1.828v1.224H9.81v1.196h1.81v1.204H9.81v1.204h1.81v1.204H9.81v1.204h1.81v1.204H9.81v1.81h5.524c0.278,0,0.505-0.235,0.505-0.524V2.494C15.84,2.205,15.612,1.97,15.334,1.97z M14.634,12.221H12.221v-1.204h2.413V12.221z M14.634,9.81H12.221v-1.204h2.413V9.81z M14.634,7.398H12.221v-1.204h2.413V7.398z M14.634,4.986H12.221v-1.204h2.413V4.986z"></path>
        <path d="M0.167,1.902v12.197L9.207,15.84V0.16L0.167,1.902z M6.011,11.064l-1.085-2.048c-0.041-0.076-0.083-0.217-0.125-0.42h-0.016c-0.02,0.095-0.07,0.238-0.147,0.431l-1.1,2.055H1.853l2.027-3.179L2.102,5.155h1.74l0.908,1.905c0.072,0.15,0.135,0.33,0.192,0.537h0.018c0.035-0.125,0.102-0.308,0.2-0.554l1.011-1.887h1.596L5.63,8.062l1.963,3.21L6.011,11.064L6.011,11.064z"></path>
      </symbol>
      <symbol id="po-icon" viewBox="0 0 32 32">
        <text x="-1" y="22" font-family="Arial" font-weight="bold" font-size="16" fill="white" style="user-select: none; pointer-events: none;">+PO</text>
      </symbol>
      <symbol id="ui-checks" viewBox="0 0 16 16">
        <path d="M7 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-1zM2 1a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2H2zm0 8a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2H2zm.854-3.646a.5.5 0 0 1-.708 0l-1-1a.5.5 0 1 1 .708-.708l.646.647 1.646-1.647a.5.5 0 1 1 .708.708l-2 2zm0 8a.5.5 0 0 1-.708 0l-1-1a.5.5 0 0 1 .708-.708l.646.647 1.646-1.647a.5.5 0 0 1 .708.708l-2 2zM7 10.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-1zm0-5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 8a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/>
      </symbol>
      <symbol id="inboxes-fill" viewBox="0 0 16 16">
        <path d="M4.98 1a.5.5 0 0 0-.39.188L1.54 5H6a.5.5 0 0 1 .5.5 1.5 1.5 0 0 0 3 0A.5.5 0 0 1 10 5h4.46l-3.05-3.812A.5.5 0 0 0 11.02 1H4.98zM3.81.563A1.5 1.5 0 0 1 4.98 0h6.04a1.5 1.5 0 0 1 1.17.563l3.7 4.625a.5.5 0 0 1 .106.374l-.39 3.124A1.5 1.5 0 0 1 14.117 10H1.883A1.5 1.5 0 0 1 .394 8.686l-.39-3.124a.5.5 0 0 1 .106-.374L3.81.563zM.125 11.17A.5.5 0 0 1 .5 11H6a.5.5 0 0 1 .5.5 1.5 1.5 0 0 0 3 0 .5.5 0 0 1 .5-.5h5.5a.5.5 0 0 1 .496.562l-.39 3.124A1.5 1.5 0 0 1 14.117 16H1.883a1.5 1.5 0 0 1-1.489-1.314l-.39-3.124a.5.5 0 0 1 .121-.393z"/>
      </symbol>
      <symbol id="people-circle" viewBox="0 0 16 16">
        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
        <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
      </symbol>
      <symbol id="calendar3" viewBox="0 0 16 16">
        <path d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857V3.857z"/>
        <path d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
      </symbol>
      <symbol id="table" viewBox="0 0 16 16">
        <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zm0 4h-4v3h4V8zm0 4h-4v3h3a1 1 0 0 0 1-1v-2zm-5 3v-3H6v3h4zm-5 0v-3H1v2a1 1 0 0 0 1 1h3zm-4-4h4V8H1v3zm0-4h4V4H1v3zm5-3v3h4V4H6zm4 4H6v3h4V8z"/>
      </symbol>
      <symbol id="chevron-right" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
      </symbol>
    </svg>

    <main class="test-style">
      <div class="container" id="production">
        <h2 class="section-heading">Production</h2>
        <div class="row">
          <div class="col">
            <div class="feature">
              <div class="feature-icon">
                <svg class="bi"><use xlink:href="#excel-file"/></svg>
              </div>
              <h2>Production Schedule</h2>
              <a href="https://adminkinpak.sharepoint.com/sites/PDTN/Shared%20Documents/Production%20Schedule/Starbrite%20KPK%20production%20schedule.xlsb" class="icon-link">
                Open Production Schedule
                <svg class="bi"><use xlink:href="#chevron-right"/></svg>
              </a>
            </div>
          </div>

          <div class="col">
            <div class="feature">
              <div class="feature-icon">
                <svg class="bi"><use xlink:href="#po-icon"/></svg>
              </div>
              <h2>KPK PO Import App</h2>
              <a href="kpkpoimport://open" class="icon-link">
                Open PO Import App
                <svg class="bi"><use xlink:href="#chevron-right"/></svg>
              </a>
            </div>
          </div>

          <div class="col">
            <div class="feature">
              <div class="feature-icon">
                <svg class="bi"><use xlink:href="#calendar3"/></svg>
              </div>
              <h2>Absentee Calendar</h2>
              <a href="https://adminkinpak.sharepoint.com/sites/PDTN/Shared%20Documents/2024%20Absentee%20Calendar%20Master.xlsx" class="icon-link">
                Open Absentee Calendar
                <svg class="bi"><use xlink:href="#calendar3"/></svg>
              </a>
            </div>
          </div>
        </div>
      </div>

      <a href="http://192.168.178.169:1337" id="kpk-app-link" class="b-example-divider-link">
        <div class="b-example-divider">
          <div class="binary-stream" aria-hidden="true"></div>
          <span class="divider-text">Open KPK App</span>
        </div>
      </a>

      <div class="container" id="blending">
        <h2 class="section-heading">Blending</h2>
        <div class="row">
          <div class="col">
            <div class="feature">
              <div class="feature-icon">
                <svg class="bi"><use xlink:href="#excel-file"/></svg>
              </div>
              <h2>Blending Schedule</h2>
              <a href="/core/blend-schedule?blend-area=all" class="icon-link">
                Open Blending Schedule
                <svg class="bi"><use xlink:href="#chevron-right"/></svg>
              </a>
            </div>
          </div>

          <div class="col">
            <div class="feature">
              <div class="feature-icon">
                <svg class="bi"><use xlink:href="#table"/></svg>
              </div>
              <h2>Lot Number Generator</h2>
              <a href="/core/lot-num-records" class="icon-link">
                Open Lot Number Generator
                <svg class="bi"><use xlink:href="#chevron-right"/></svg>
              </a>
            </div>
          </div>

          <div class="col">
            <div class="feature">
              <div class="feature-icon">
                <svg class="bi"><use xlink:href="#table"/></svg>
              </div>
              <h2>Tanks and Totes</h2>
              <a href="https://adminkinpak.sharepoint.com/sites/BLND/Shared%20Documents/01%20Spreadsheet%20Tools/Blending%20Daily%20Inventory/Prod/Blending%20Tanks%20and%20Totes%20Inventory.xlsb" class="icon-link">
                Open Tanks and Totes Sheet
                <svg class="bi"><use xlink:href="#chevron-right"/></svg>
              </a>
              <a href="http://192.168.178.169:1337/core/tank-levels/" class="icon-link">
                Open Tank Radar Levels Page
                <svg class="bi"><use xlink:href="#chevron-right"/></svg>
              </a>
            </div>
          </div>
        </div>
      </div>
    </main>

    <button class="theme-toggle" aria-label="Toggle theme">
        <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM12 21.75a.75.75 0 01-.75-.75v-2.25a.75.75 0 011.5 0V21a.75.75 0 01-.75.75zM3 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3.75A.75.75 0 013 12zM21 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5h2.25A.75.75 0 0121 12zM5.47 5.47a.75.75 0 011.06 0l1.59 1.59a.75.75 0 11-1.06 1.06L5.47 6.53a.75.75 0 010-1.06zM18.53 5.47a.75.75 0 010 1.06l-1.59 1.59a.75.75 0 01-1.06-1.06l1.59-1.59a.75.75 0 011.06 0zM5.47 18.53a.75.75 0 010-1.06l1.59-1.59a.75.75 0 111.06 1.06l-1.59 1.59a.75.75 0 01-1.06 0zM18.53 18.53a.75.75 0 01-1.06 0l-1.59-1.59a.75.75 0 111.06-1.06l1.59 1.59a.75.75 0 010 1.06z"/>
        </svg>
        <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display: none;">
            <path d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"/>
        </svg>
    </button>

    <script>
        // Update toggle icons based on theme
        const updateToggleIcons = (theme) => {
            const sunIcon = document.querySelector('.sun-icon');
            const moonIcon = document.querySelector('.moon-icon');
            if (sunIcon && moonIcon) {
                if (theme === 'dark') {
                    sunIcon.style.display = 'none';
                    moonIcon.style.display = 'block';
                } else {
                    sunIcon.style.display = 'block';
                    moonIcon.style.display = 'none';
                }
            }
        };

        // Theme toggle function
        const setTheme = (theme) => {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            updateToggleIcons(theme);
        };

        // Initialize toggle icons once DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            updateToggleIcons(currentTheme);

            // Add toggle button handler
            document.querySelector('.theme-toggle').addEventListener('click', () => {
                const theme = document.documentElement.getAttribute('data-theme');
                setTheme(theme === 'dark' ? 'light' : 'dark');
            });
        });

        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (!localStorage.getItem('theme')) {
                setTheme(e.matches ? 'dark' : 'light');
            }
        });
    </script>

    <script>
        // Cache DOM queries and frequently used values
        const stream = document.querySelector('.binary-stream');
        const divider = document.querySelector('.b-example-divider');
        const dividerText = document.querySelector('.divider-text');
        
        // Constants
        const SPAWN_INTERVAL = 75;
        const ACTIVE_SPAWNERS = 2;
        const MAX_ITEMS = 100;
        const ANIMATION_BASE = 1.5;
        const ANIMATION_VARIANCE = 2.5;
        
        // State management
        const state = {
            itemCodes: [],
            remainingIndices: [],
            isDataLoaded: false,
            isAnimating: false,
            animationFrame: null,
            textBounds: null,
            lastWidth: 0
        };

        // Optimized random item code selection
        const getRandomItemCode = () => {
            if (state.remainingIndices.length === 0) {
                state.remainingIndices = Array.from(
                    { length: state.itemCodes.length },
                    (_, i) => i
                );
            }
            const randomIndex = ~~(Math.random() * state.remainingIndices.length);
            const selectedIndex = state.remainingIndices[randomIndex];
            state.remainingIndices[randomIndex] = state.remainingIndices[state.remainingIndices.length - 1];
            state.remainingIndices.length--;
            return state.itemCodes[selectedIndex];
        };

        const getRandomDuration = () => (Math.random() * ANIMATION_VARIANCE + ANIMATION_BASE).toFixed(2) + 's';
        const getCurrentItemCount = () => stream.children.length;

        // Cache for getBoundingClientRect calculations
        let rectCache = {
            divider: null,
            text: null,
            timestamp: 0
        };

        function updateTextBounds() {
            const now = performance.now();
            if (now - rectCache.timestamp < 1000 && rectCache.divider && state.lastWidth === rectCache.divider.width) {
                return state.textBounds;
            }

            const dividerRect = divider.getBoundingClientRect();
            const textRect = dividerText.getBoundingClientRect();
            
            rectCache = {
                divider: dividerRect,
                text: textRect,
                timestamp: now
            };
            
            state.lastWidth = dividerRect.width;
            
            const textCenter = (textRect.left + textRect.right) / 2;
            const dividerCenter = (dividerRect.left + dividerRect.right) / 2;
            const textWidth = textRect.width;
            const padding = dividerRect.width < 600 ? 60 : 100;
            const totalWidth = textWidth + padding;
            const halfTotalWidth = totalWidth / 2;
            
            const leftBound = ((dividerCenter - halfTotalWidth - dividerRect.left) / dividerRect.width) * 100;
            const rightBound = ((dividerCenter + halfTotalWidth - dividerRect.left) / dividerRect.width) * 100;

            state.textBounds = {
                start: Math.max(0, leftBound),
                end: Math.min(100, rightBound)
            };
            
            return state.textBounds;
        }

        function createItemCodeElement() {
            const codeElement = document.createElement('div');
            const bounds = updateTextBounds();
            
            let position;
            if (Math.random() < 0.5) {
                position = Math.random() * (bounds.start * 0.9);
            } else {
                position = bounds.end + (Math.random() * (100 - bounds.end) * 0.9);
            }

            codeElement.className = 'binary';
            codeElement.style.cssText = `left:${position}%;animation-duration:${getRandomDuration()}`;
            codeElement.textContent = getRandomItemCode();
            
            codeElement.addEventListener('animationend', () => {
                stream.contains(codeElement) && stream.removeChild(codeElement);
            }, { once: true });

            return codeElement;
        }

        function cleanupAnimation() {
            state.isAnimating = false;
            if (state.animationFrame) {
                clearTimeout(state.animationFrame);
                state.animationFrame = null;
            }
            while (stream.firstChild) {
                stream.removeChild(stream.firstChild);
            }
        }

        const spawnItemCode = () => {
            if (!state.isAnimating || !state.isDataLoaded) return;

            if (getCurrentItemCount() >= MAX_ITEMS) {
                state.isAnimating && (state.animationFrame = setTimeout(spawnItemCode, SPAWN_INTERVAL));
                return;
            }

            const element = createItemCodeElement();
            stream.appendChild(element);

            if (state.isAnimating) {
                state.animationFrame = setTimeout(spawnItemCode, SPAWN_INTERVAL + (Math.random() * 50));
            }
        };

        const startAnimation = () => {
            if (!state.isDataLoaded || state.isAnimating) return;
            cleanupAnimation();
            state.isAnimating = true;
            for (let i = 0; i < ACTIVE_SPAWNERS; i++) {
                setTimeout(spawnItemCode, i * (SPAWN_INTERVAL / 2));
            }
        };

        // Initialize
        fetch(`${window.location.protocol}//${window.location.hostname}:1337/core/get-BOM-fields/?restriction=`, {
            method: 'GET',
            credentials: 'include',
            headers: { 'Accept': 'application/json' }
        })
        .then(response => response.ok ? response.json() : Promise.reject(`HTTP error! status: ${response.status}`))
        .then(data => {
            if (data?.item_codes?.length) {
                state.itemCodes = data.item_codes;
                state.remainingIndices = Array.from(
                    { length: state.itemCodes.length },
                    (_, i) => i
                );
                state.isDataLoaded = true;
                startAnimation();
            }
        })
        .catch(console.error);

        // Event binding
        document.addEventListener('DOMContentLoaded', () => {
            state.isDataLoaded && startAnimation();
        }, { once: true });

        const debouncedResize = (() => {
            let timeout;
            return () => {
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    if (state.isDataLoaded) {
                        rectCache.timestamp = 0;
                        cleanupAnimation();
                        startAnimation();
                    }
                }, 150);
            };
        })();

        new ResizeObserver(debouncedResize).observe(divider);
        
        document.addEventListener('visibilitychange', () => {
            state.isDataLoaded && (document.hidden ? cleanupAnimation() : startAnimation());
        });

        // Ensure animation only plays once
        const style = document.createElement('style');
        style.textContent = `
            .binary {
                position: absolute;
                top: 0;
                font-family: monospace;
                font-size: 12px;
                color: rgba(255, 255, 255, 0.7);
                animation-name: binaryDrop;
                animation-timing-function: linear;
                animation-fill-mode: forwards;
                animation-iteration-count: 1;
                white-space: pre;
            }

            @keyframes binaryDrop {
                0% {
                    transform: translateY(-100%);
                    opacity: 0;
                }
                5% {
                    opacity: 0.7;
                }
                95% {
                    opacity: 0.7;
                }
                100% {
                    transform: translateY(600%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>

    <style>
    .portal-effect {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        perspective: 2500px;
        pointer-events: none;
        z-index: 9999;
    }

    .b-example-divider {
        transition: all 0.3s ease;
        transform-style: preserve-3d;
        overflow: hidden;
    }

    .diving-animation .b-example-divider {
        position: fixed;
        width: 100%;
        animation: expandFromCenter 1.2s cubic-bezier(0.19, 1, 0.22, 1) forwards;
    }

    .diving-animation .divider-text {
        animation: zoomPast 1.2s cubic-bezier(0.19, 1, 0.22, 1) forwards;
        position: relative;
        transform-origin: center center;
    }

    .diving-animation .binary-stream {
        animation: streamAccelerate 1.2s cubic-bezier(0.19, 1, 0.22, 1) forwards;
    }

    .destination-point {
        position: fixed;
        top: 50%;
        left: 50%;
        width: 1px;
        height: 1px;
        opacity: 0;
        transform: translate(-50%, -50%);
        z-index: 10000;
        background: linear-gradient(
            to bottom,
            rgb(13, 110, 253) 0%,
            rgb(13, 110, 253) 4.25%,
            white 4.25%,
            white 100%
        );
        pointer-events: none;
    }

    .diving-animation .destination-point {
        animation: destPoint 0.25s cubic-bezier(0.55, 0.055, 0.675, 0.19) forwards;
        animation-delay: 0.3s;
    }

    @keyframes expandFromCenter {
        0% {
            transform: perspective(2500px) translateZ(0);
            opacity: 1;
        }
        100% {
            transform: perspective(2500px) translateZ(2500px) scale(6);
            opacity: 1;
        }
    }

    @keyframes zoomPast {
        0% {
            transform: scale(1) translateZ(0);
        }
        40% {
            transform: scale(4) translateZ(1000px);
            opacity: 1;
        }
        45% {
            opacity: 0;
        }
        100% {
            transform: scale(8) translateZ(2000px);
            opacity: 0;
        }
    }

    @keyframes streamAccelerate {
        0% {
            transform: translateY(0);
        }
        100% {
            transform: translateY(3000%);
        }
    }

    @keyframes destPoint {
        0% {
            opacity: 0;
            width: 1px;
            height: 1px;
        }
        1% {
            opacity: 1;
            width: 1px;
            height: 1px;
        }
        100% {
            opacity: 1;
            width: 100vw;
            height: 100vh;
        }
    }
    </style>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const divider = document.querySelector('.b-example-divider');
        
        document.querySelector('.b-example-divider-link').addEventListener('click', function(e) {
            e.preventDefault();
            
            // Begin loading the destination page immediately
            const destinationUrl = this.getAttribute('href');
            fetch(destinationUrl, {
                method: 'GET',
                credentials: 'include',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            });
            
            // Rest of the animation code...
            const rect = divider.getBoundingClientRect();
            
            // Create a container for the binary animation
            const binaryContainer = document.createElement('div');
            binaryContainer.className = 'binary-container';
            document.body.style.setProperty('--divider-top', rect.top + 'px');
            document.body.style.setProperty('--divider-height', rect.height + 'px');
            document.body.appendChild(binaryContainer);
            
            // Get the center point of the divider
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            // Clone existing binary elements into our new container
            const existingBinary = document.querySelectorAll('.binary-stream .binary');
            existingBinary.forEach(binary => {
                const binaryRect = binary.getBoundingClientRect();
                const clone = binary.cloneNode(true);
                
                // Calculate offset from center
                const offsetX = binaryRect.left - centerX;
                const offsetY = binaryRect.top - centerY;
                
                clone.style.position = 'absolute';
                clone.style.left = binaryRect.left + 'px';
                clone.style.top = binaryRect.top + 'px';
                clone.style.setProperty('--offset-x', offsetX + 'px');
                clone.style.setProperty('--offset-y', offsetY + 'px');
                
                binaryContainer.appendChild(clone);
            });
            
            // Set the exact position and dimensions
            divider.style.top = rect.top + 'px';
            divider.style.height = rect.height + 'px';
            divider.style.left = '0';
            divider.style.margin = '0';
            
            requestAnimationFrame(() => {
                document.body.classList.add('diving-animation');
                
                // Add slight delay before creating destination point
                requestAnimationFrame(() => {
                    const destPoint = document.createElement('div');
                    destPoint.className = 'destination-point';
                    document.body.appendChild(destPoint);
                });
                
                setTimeout(() => {
                    window.location.href = destinationUrl;
                }, 800);
            });
        });
    });
    </script>

    <style>
    .portal-effect {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: radial-gradient(circle at center, #2196f3, #1976d2);
        opacity: 0;
        transform: scale(0);
        transform-origin: center;
        transition: all 1s cubic-bezier(0.645, 0.045, 0.355, 1.000);
        z-index: 9999;
        pointer-events: none;
    }

    .open-kpk-app {
        cursor: pointer;
        transition: transform 0.3s ease;
    }

    .open-kpk-app:hover {
        transform: scale(1.02);
    }
    </style>

    <style>
    .binary-stream {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        overflow: hidden;
    }

    .b-example-divider {
        position: relative;
        overflow: hidden;
    }

    .binary {
        position: absolute;
        font-family: monospace;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.7);
        white-space: pre;
    }

    .binary-container {
        position: fixed;
        overflow: hidden;
        perspective: 2500px;
        transform-style: preserve-3d;
        pointer-events: none;
        z-index: 9998;
    }

    .diving-animation .binary-container {
        width: 100%;
        height: var(--divider-height);
        top: var(--divider-top);
        left: 0;
    }

    .diving-animation .binary {
        animation: zoomBinary 1.5s cubic-bezier(0.19, 1, 0.22, 1) forwards !important;
        position: absolute;
        transform-origin: center center;
    }

    @keyframes zoomBinary {
        0% {
            transform: translateX(var(--offset-x, 0)) 
                       translateY(var(--offset-y, 0)) 
                       translateZ(0)
                       scale(1);
            opacity: 0.7;
        }
        40% {
            transform: translateX(calc(var(--offset-x, 0) * 4))
                       translateY(calc(var(--offset-y, 0) * 4))
                       translateZ(1000px)
                       scale(4);
            opacity: 0.7;
        }
        100% {
            transform: translateX(calc(var(--offset-x, 0) * 8))
                       translateY(calc(var(--offset-y, 0) * 8))
                       translateZ(2000px)
                       scale(8);
            opacity: 0;
        }
    }
    </style>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const divider = document.querySelector('.b-example-divider');
        
        document.querySelector('.b-example-divider-link').addEventListener('click', function(e) {
            e.preventDefault();
            
            // Begin loading the destination page immediately
            const destinationUrl = this.getAttribute('href');
            fetch(destinationUrl, {
                method: 'GET',
                credentials: 'include',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            });
            
            // Rest of the animation code...
            const rect = divider.getBoundingClientRect();
            
            // Create a container for the binary animation
            const binaryContainer = document.createElement('div');
            binaryContainer.className = 'binary-container';
            document.body.style.setProperty('--divider-top', rect.top + 'px');
            document.body.style.setProperty('--divider-height', rect.height + 'px');
            document.body.appendChild(binaryContainer);
            
            // Get the center point of the divider
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            // Clone existing binary elements into our new container
            const existingBinary = document.querySelectorAll('.binary-stream .binary');
            existingBinary.forEach(binary => {
                const binaryRect = binary.getBoundingClientRect();
                const clone = binary.cloneNode(true);
                
                // Calculate offset from center
                const offsetX = binaryRect.left - centerX;
                const offsetY = binaryRect.top - centerY;
                
                clone.style.position = 'absolute';
                clone.style.left = binaryRect.left + 'px';
                clone.style.top = binaryRect.top + 'px';
                clone.style.setProperty('--offset-x', offsetX + 'px');
                clone.style.setProperty('--offset-y', offsetY + 'px');
                
                binaryContainer.appendChild(clone);
            });
            
            // Set the exact position and dimensions
            divider.style.top = rect.top + 'px';
            divider.style.height = rect.height + 'px';
            divider.style.left = '0';
            divider.style.margin = '0';
            
            requestAnimationFrame(() => {
                document.body.classList.add('diving-animation');
                
                // Add slight delay before creating destination point
                requestAnimationFrame(() => {
                    const destPoint = document.createElement('div');
                    destPoint.className = 'destination-point';
                    document.body.appendChild(destPoint);
                });
                
                setTimeout(() => {
                    window.location.href = destinationUrl;
                }, 800);
            });
        });
    });
    </script>

    <script>
        // Add this after your existing scripts
        document.addEventListener('DOMContentLoaded', function() {
            const productionHeading = document.querySelector('#production .section-heading');
            const currentMonth = new Date().getMonth(); // 0-11, where 11 is December
            
            if (currentMonth === 11) { // December
                productionHeading.classList.add('december');
            }
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dividerText = document.querySelector('.divider-text');
            let rect = dividerText.getBoundingClientRect();
            
            document.addEventListener('mousemove', function(e) {
                rect = dividerText.getBoundingClientRect();
                
                // Calculate the absolute position the light wants to be at
                const desiredX = e.clientX;
                const desiredY = e.clientY;
                
                // Calculate distance for intensity
                const buttonCenterX = rect.left + rect.width / 2;
                const buttonCenterY = rect.top + rect.height / 2;
                const dx = desiredX - buttonCenterX;
                const dy = desiredY - buttonCenterY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const maxDistance = Math.sqrt(
                    Math.pow(window.innerWidth, 2) + 
                    Math.pow(window.innerHeight, 2)
                );
                const normalizedDistance = distance / maxDistance;
                
                // Convert desired absolute position to percentage within button bounds
                let lightX = ((desiredX - rect.left) / rect.width) * 100;
                let lightY = ((desiredY - rect.top) / rect.height) * 100;
                
                // Constrain to button bounds
                lightX = Math.max(0, Math.min(100, lightX));
                lightY = Math.max(0, Math.min(100, lightY));
                
                // Update CSS variables
                dividerText.style.setProperty('--light-x', `${lightX}%`);
                dividerText.style.setProperty('--light-y', `${lightY}%`);
                dividerText.style.setProperty('--light-distance', normalizedDistance);
            });

            window.addEventListener('scroll', () => rect = dividerText.getBoundingClientRect());
            window.addEventListener('resize', () => {
                rect = dividerText.getBoundingClientRect();
                document.dispatchEvent(new MouseEvent('mousemove', {
                    clientX: event.clientX,
                    clientY: event.clientY
                }));
            });
            
            rect = dividerText.getBoundingClientRect();
        });
    </script>
  </body>
</html>
